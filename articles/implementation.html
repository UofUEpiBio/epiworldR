<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="epiworldR">
<title>Implementation details of epiworldR • epiworldR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Implementation details of epiworldR">
<meta property="og:description" content="epiworldR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epiworldR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0-3.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting-started.html">Getting started with epiworldR</a>
    <a class="dropdown-item" href="../articles/implementation.html">Implementation details of epiworldR</a>
    <a class="dropdown-item" href="../articles/run-multiple.html">Run Multiple</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/UofUEpiBio/epiworldR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Implementation details of epiworldR</h1>
                        <h4 data-toc-skip class="author">George Vega
Yon</h4>
                        <h4 data-toc-skip class="author">Derek
Meyer</h4>
            
            <h4 data-toc-skip class="date">2023-06-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/UofUEpiBio/epiworldR/blob/HEAD/vignettes/implementation.Rmd" class="external-link"><code>vignettes/implementation.Rmd</code></a></small>
      <div class="d-none name"><code>implementation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The following vignette provides detailed information about the
implementation of <code>epiworldR</code>. The package is a wrapper of
the C++ package <code>epiworld</code>, a framework for building
agent-based models.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The C++ package is available at &lt;a href="https://github.com/UofUEpiBio/epiworld" class="external-link"&gt;https://github.com/UofUEpiBio/epiworld&lt;/a&gt;.&lt;/p&gt;'><sup>1</sup></a></p>
</div>
<div class="section level2">
<h2 id="general-flow-of-the-models">General flow of the models<a class="anchor" aria-label="anchor" href="#general-flow-of-the-models"></a>
</h2>
<p>The core function of <code>epiworldR</code> is the <code><a href="../reference/epiworld-methods.html">run()</a></code>
function. This function executes the model and saves the results in a
database part of the underlying C++ object. The package implements a
discrete-time ABM, meaning the model is executed in discrete steps
(<em>e.g.</em>, days). The <code><a href="../reference/epiworld-methods.html">run()</a></code> function executes the
following steps:</p>
<ol style="list-style-type: decimal">
<li>The model is <code>reset()</code>, which involves: (a) resetting the
agents, or if available, restoring the population backup<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Population backups are created on the fly the first time
the model is run. Generally, backups are relevant for undoing changes in
the network structure. Although &lt;code&gt;epiworld&lt;/code&gt; (C++) provides a
way to change network structure, the current version of
&lt;code&gt;epiworldR&lt;/code&gt; does not.&lt;/p&gt;"><sup>2</sup></a>, (b) resetting the
database, (c) distributing viruses and tools, (d) and setting the
initial state of agents. All these steps fixing
<code>current_date = 0</code>.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li><p>The model’s state is recorded in the database, and the
<code>current_date</code> is incremented by 1.</p></li>
<li>
<p>After resetting the model, we start an iterative process
repeating the following steps:</p>
<ol style="list-style-type: lower-alpha">
<li>
<p>The state of each agent is updated. States are updated according
to their corresponding <code>update_state</code> function.</p>
<p>Since the model is discrete-time, <strong>state changes are stored as
promises</strong>, meaning that agents’ states are not updated
immediately. Instead, the state is updated at the end of the updates.
This is done to avoid updating the state of an agent and then using the
updated state to update the state of another agent. For example, if
agent <span class="math inline">\(i\)</span> infects agent <span class="math inline">\(j\)</span>, then agent <span class="math inline">\(j\)</span> should not be able to infect agent
<span class="math inline">\(i\)</span> in the same step.</p>
</li>
<li><p>Once the update schedule is laid out, the changes are made
effective, so, for instance, individuals who became infected during the
update will start the next step in the infected state.</p></li>
<li><p>Global actions are executed. These could also change agents’
states, so just like in the previous step, these changes are stored as
promises and made effective once all actions have been
evaluated.</p></li>
<li><p>The model’s state is recorded in the database, and the
<code>current_date</code> is incremented by 1.</p></li>
<li><p>The model checks whether the simulation should stop. If the
simulation should stop, the model stops. Otherwise, the model goes back
to step a.</p></li>
</ol>
</li>
</ol>
<p>Other steps included in <code>epiworld</code> but not in
<code>epiworldR</code> are the network rewiring and mutation of viruses.
These will be implemented in future versions of
<code>epiworldR</code>.</p>
</div>
<div class="section level2">
<h2 id="computing-probabilities">Computing probabilities<a class="anchor" aria-label="anchor" href="#computing-probabilities"></a>
</h2>
<div class="section level3">
<h3 id="transmission-probability">Transmission probability<a class="anchor" aria-label="anchor" href="#transmission-probability"></a>
</h3>
<p>Generally, <code>epiworldR</code> assumes that at each step of the
simulation, susceptible agents can acquire the disease from at most one
infected agent. The probability of transmission from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> is given by the following formula:</p>
<p><span class="math display">\[
P(i\to j| \mbox{at most one}) = \frac{p_{ij} \times \prod_{k\neq
i}\left(1 - p_{kj}\right)}{\prod_k\left(1 - p_{kj}\right) + \sum_k
p_{kj} \times \prod_{l\neq k}\left(1 - p_{lj}\right)}
\]</span></p>
<p>The adjusted probabilities <span class="math inline">\(p_{ij}\)</span> are computed as a function of
<span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>, and the virus. The following section
describes how these probabilities are computed.</p>
</div>
<div class="section level3">
<h3 id="adjusted-probabilities">Adjusted probabilities<a class="anchor" aria-label="anchor" href="#adjusted-probabilities"></a>
</h3>
<p>Viruses and tools provide a way to adjust how agents move between
states. Viruses in <code>epiworldR</code> contain various baseline
probabilities used across models, including transmission, recovery, and
death. On the other hand, tools alter these probabilities by
reducing/increasing them. Furthermore, tools alter agents’
susceptibility, infectiousness, recovery, and death probabilities.
Currently, tools alter these probabilities by a constant factor,</p>
<p><span class="math display">\[
p_{ij} = p_{v} \times \left(1 - factor_{host}\right) \times \left(1 -
factor_{target}\right)
\]</span></p>
<p>Where <span class="math inline">\(p_{v}\)</span> is the raw
transmission probability of the virus <span class="math inline">\(v\)</span>, and <span class="math inline">\(factor_{t}\)</span> are the increasing/reducing
factors tools have over the process. For example, if <code>p_v</code>
was 0.9, the host was wearing a mask, so <span class="math inline">\(factor_{\mbox{mask host}} = 0.3\)</span> and the
target was vaccinated, so <span class="math inline">\(factor_{\mbox{vaccinated target}} = 0.5\)</span>,
then the adjusted probability <span class="math inline">\(p_{ij}\)</span> would be <span class="math inline">\(0.9 \times (1 - 0.3) \times (1 - 0.5) =
0.27\)</span>.</p>
<p>When agents have more than one tool, factors are combined as
follows:</p>
<p><span class="math display">\[
factor_{agent} = 1 - \prod_{t\in tools_{agent}}\left(1 -
factor_{t}\right)
\]</span></p>
<p>Therefore, for example, a vaccinated agent wearing a mask would have
a factor of <span class="math inline">\(1 - (1 - 0.30) \times (1 - 0.5)
= 0.65\)</span>. The adjusted probabilities principle also applies to
recovery rates in the SIR and SEIR models.</p>
</div>
<div class="section level3">
<h3 id="transmission-in-connected-modelsmodels">Transmission in connected models<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The following section applies to the
&lt;code&gt;ModelSIRCONN&lt;/code&gt; and &lt;code&gt;ModelSEIRCONN&lt;/code&gt; models. The
&lt;code&gt;ModelSIR&lt;/code&gt; and &lt;code&gt;ModelSEIR&lt;/code&gt; models are similar but
do not use a connected network.&lt;/p&gt;"><sup>3</sup></a><a class="anchor" aria-label="anchor" href="#transmission-in-connected-modelsmodels"></a>
</h3>
<p>The “connected” models provide a version where agents live in a fully
connected network. This means that each agent can infect any other
agent, making this version similar to typical compartmental models. In
these models, the transmission probability depends on the contact rate.
For each susceptible agent, the transmission process is simulated as
follows:</p>
<ol style="list-style-type: decimal">
<li><p>The number of contacts <span class="math inline">\(c\)</span> is
drawn from a binomial distribution with parameters <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span>, where <span class="math inline">\(n\)</span> is the number of agents and <span class="math inline">\(p =\)</span><code>contact_rate</code><span class="math inline">\(/ n\)</span>.</p></li>
<li><p>Then, <span class="math inline">\(c\)</span> agents are randomly
selected from the population. Transmission can then occur from any of
these agents to the susceptible agent.</p></li>
<li><p>The probability of transmission from each of the <span class="math inline">\(c\)</span> agents is calculated as described in
the previous section.</p></li>
</ol>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Derek Meyer, George Vega Yon, Centers for Disease Control and Prevention.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
