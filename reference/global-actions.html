<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Global Actions — global-actions • epiworldR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Global Actions — global-actions"><meta name="description" content="Global actions are functions that are executed at each time step of the
simulation. They are useful for implementing interventions, such as
vaccination, isolation, and social distancing by means of tools."><meta property="og:description" content="Global actions are functions that are executed at each time step of the
simulation. They are useful for implementing interventions, such as
vaccination, isolation, and social distancing by means of tools."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiworldR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3-2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with epiworldR</a></li>
    <li><a class="dropdown-item" href="../articles/implementation.html">Implementation details of epiworldR</a></li>
    <li><a class="dropdown-item" href="../articles/mixing.html">Mixing models</a></li>
    <li><a class="dropdown-item" href="../articles/run-multiple.html">Run Multiple</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UofUEpiBio/epiworldR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Global Actions</h1>
      <small class="dont-index">Source: <a href="https://github.com/UofUEpiBio/epiworldR/blob/main/R/global-actions.R" class="external-link"><code>R/global-actions.R</code></a></small>
      <div class="d-none name"><code>global-actions.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Global actions are functions that are executed at each time step of the
simulation. They are useful for implementing interventions, such as
vaccination, isolation, and social distancing by means of tools.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">globalevent_tool</span><span class="op">(</span><span class="va">tool</span>, <span class="va">prob</span>, name <span class="op">=</span> <span class="fu"><a href="tool.html">get_name_tool</a></span><span class="op">(</span><span class="va">tool</span><span class="op">)</span>, day <span class="op">=</span> <span class="op">-</span><span class="fl">99</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">globalevent_tool_logit</span><span class="op">(</span></span>
<span>  <span class="va">tool</span>,</span>
<span>  <span class="va">vars</span>,</span>
<span>  <span class="va">coefs</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="tool.html">get_name_tool</a></span><span class="op">(</span><span class="va">tool</span><span class="op">)</span>,</span>
<span>  day <span class="op">=</span> <span class="op">-</span><span class="fl">99</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">globalevent_set_params</span><span class="op">(</span></span>
<span>  <span class="va">param</span>,</span>
<span>  <span class="va">value</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Set "</span>, <span class="va">param</span>, <span class="st">" to "</span>, <span class="va">value</span><span class="op">)</span>,</span>
<span>  day <span class="op">=</span> <span class="op">-</span><span class="fl">99</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">globalevent_fun</span><span class="op">(</span><span class="va">fun</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">fun</span><span class="op">)</span><span class="op">)</span>, day <span class="op">=</span> <span class="op">-</span><span class="fl">99</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_globalevent</span><span class="op">(</span><span class="va">model</span>, <span class="va">action</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tool">tool<a class="anchor" aria-label="anchor" href="#arg-tool"></a></dt>
<dd><p>An object of class <a href="tool.html">tool</a>.</p></dd>


<dt id="arg-prob">prob<a class="anchor" aria-label="anchor" href="#arg-prob"></a></dt>
<dd><p>Numeric scalar. A probability between 0 and 1.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>Character scalar. The name of the action.</p></dd>


<dt id="arg-day">day<a class="anchor" aria-label="anchor" href="#arg-day"></a></dt>
<dd><p>Integer. The day (step) at which the action is executed (see details).</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>Integer vector. The position of the variables in the model.</p></dd>


<dt id="arg-coefs">coefs<a class="anchor" aria-label="anchor" href="#arg-coefs"></a></dt>
<dd><p>Numeric vector. The coefficients of the logistic regression.</p></dd>


<dt id="arg-param">param<a class="anchor" aria-label="anchor" href="#arg-param"></a></dt>
<dd><p>Character scalar. The name of the parameter to be set.</p></dd>


<dt id="arg-value">value<a class="anchor" aria-label="anchor" href="#arg-value"></a></dt>
<dd><p>Numeric scalar. The value of the parameter.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Function. The function to be executed.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>An object of class <a href="epiworld-methods.html">epiworld_model</a>.</p></dd>


<dt id="arg-action">action<a class="anchor" aria-label="anchor" href="#arg-action"></a></dt>
<dd><p>A global action.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>

<ul><li><p>The <code>globalevent_set_params</code> function returns an object of class
epiworld_globalevent_set_param and epiworld_globalevent.</p></li>
<li><p><code>globalevent_tool</code> returns an object of class
epiworld_globalevent_tool and epiworld_globalevent.</p></li>
<li><p><code>globalevent_tool_logit</code> returns an object of class
epiworld_globalevent_tool_logit and epiworld_globalevent.</p></li>
</ul><ul><li><p>The function <code>add_globalevent</code> returns the model with the added
action.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function <code>globalevent_tool_logit</code> allows to specify a logistic
regression model for the probability of using a tool. The model is specified
by the vector of coefficients <code>coefs</code> and the vector of variables <code>vars</code>.
<code>vars</code> is an integer vector indicating the position of the variables in the
model.</p>
<p>The function <code>globalevent_set_param</code> allows to set a parameter of
the model. The parameter is specified by its name <code>param</code> and the value by
<code>value</code>.</p>
<p>The function <code>globalevent_fun</code> allows to specify a function to be
executed at a given day. The function object must receive an object of class
<a href="epiworld-methods.html">epiworld_model</a> as only argument.</p>
<p>The function <code>add_globalevent</code> adds a global action to a model.
The model checks for actions to be executed at each time step. If the added
action matches the current time step, the action is executed. When <code>day</code> is
negative, the action is executed at each time step. When <code>day</code> is positive,
the action is executed at the specified time step.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>epiworld-model</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simple model</span></span></span>
<span class="r-in"><span><span class="va">model_sirconn</span> <span class="op">&lt;-</span> <span class="fu"><a href="ModelSIRCONN.html">ModelSIRCONN</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name                <span class="op">=</span> <span class="st">"COVID-19"</span>,</span></span>
<span class="r-in"><span>  n                   <span class="op">=</span> <span class="fl">10000</span>,</span></span>
<span class="r-in"><span>  prevalence          <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>  contact_rate        <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  transmission_rate   <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  recovery_rate       <span class="op">=</span> <span class="fl">0.95</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Creating a tool</span></span></span>
<span class="r-in"><span><span class="va">epitool</span> <span class="op">&lt;-</span> <span class="fu"><a href="tool.html">tool</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="st">"Vaccine"</span>,</span></span>
<span class="r-in"><span>  prevalence <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  as_proportion <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  susceptibility_reduction <span class="op">=</span> <span class="fl">.9</span>,</span></span>
<span class="r-in"><span>  transmission_reduction <span class="op">=</span> <span class="fl">.5</span>,</span></span>
<span class="r-in"><span>  recovery_enhancer <span class="op">=</span> <span class="fl">.5</span>, </span></span>
<span class="r-in"><span>  death_reduction <span class="op">=</span> <span class="fl">.9</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Adding a global action</span></span></span>
<span class="r-in"><span><span class="va">vaccine_day_20</span> <span class="op">&lt;-</span> <span class="fu">globalevent_tool</span><span class="op">(</span><span class="va">epitool</span>, <span class="fl">.2</span>, day <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">add_globalevent</span><span class="op">(</span><span class="va">model_sirconn</span>, <span class="va">vaccine_day_20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Running and printing</span></span></span>
<span class="r-in"><span><span class="fu"><a href="epiworld-methods.html">run</a></span><span class="op">(</span><span class="va">model_sirconn</span>, ndays <span class="op">=</span> <span class="fl">40</span>, seed <span class="op">=</span> <span class="fl">1912</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _________________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Running the model...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | done.</span>
<span class="r-in"><span><span class="va">model_sirconn</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ________________________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Susceptible-Infected-Removed (SIR) (connected)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> It features 10000 agents, 1 virus(es), and 1 tool(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The model has 3 states.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The final distribution is: 2056 Susceptible, 0 Infected, and 7944 Recovered.</span>
<span class="r-in"><span><span class="fu"><a href="epiworld-data.html">plot_incidence</a></span><span class="op">(</span><span class="va">model_sirconn</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="global-actions-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Changing the contact rate -------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">model_sirconn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="ModelSIRCONN.html">ModelSIRCONN</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name                <span class="op">=</span> <span class="st">"COVID-19"</span>,</span></span>
<span class="r-in"><span>  n                   <span class="op">=</span> <span class="fl">10000</span>,</span></span>
<span class="r-in"><span>  prevalence          <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>  contact_rate        <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  transmission_rate   <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  recovery_rate       <span class="op">=</span> <span class="fl">0.95</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">closure_day_10</span> <span class="op">&lt;-</span> <span class="fu">globalevent_set_params</span><span class="op">(</span><span class="st">"Contact rate"</span>, <span class="fl">0</span>, day <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">add_globalevent</span><span class="op">(</span><span class="va">model_sirconn2</span>, <span class="va">closure_day_10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Running and printing</span></span></span>
<span class="r-in"><span><span class="fu"><a href="epiworld-methods.html">run</a></span><span class="op">(</span><span class="va">model_sirconn2</span>, ndays <span class="op">=</span> <span class="fl">40</span>, seed <span class="op">=</span> <span class="fl">1912</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _________________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Running the model...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | done.</span>
<span class="r-in"><span><span class="va">model_sirconn2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ________________________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Susceptible-Infected-Removed (SIR) (connected)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> It features 10000 agents, 1 virus(es), and 0 tool(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The model has 3 states.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The final distribution is: 2115 Susceptible, 0 Infected, and 7885 Recovered.</span>
<span class="r-in"><span><span class="fu"><a href="epiworld-data.html">plot_incidence</a></span><span class="op">(</span><span class="va">model_sirconn2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="global-actions-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Example using `globalevent_fun` to record the state of the</span></span></span>
<span class="r-in"><span><span class="co"># agents at each time step.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We start by creating an SIR connected model</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="ModelSIRCONN.html">ModelSIRCONN</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name              <span class="op">=</span> <span class="st">"SIR with Global Saver"</span>,</span></span>
<span class="r-in"><span>  n                 <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  prevalence        <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>  contact_rate      <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  transmission_rate <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  recovery_rate     <span class="op">=</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We create the object where the history of the agents will be stored</span></span></span>
<span class="r-in"><span><span class="va">agents_history</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This function prints the total number of agents in each state</span></span></span>
<span class="r-in"><span><span class="co"># and stores the history of the agents in the object `agents_history`</span></span></span>
<span class="r-in"><span><span class="va">hist_saver</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Today's totals are: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="epiworld-data.html">get_today_total</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># We use the `&lt;&lt;-` operator to assign the value to the global variable</span></span></span>
<span class="r-in"><span>  <span class="co"># `agents_history` (see ?"&lt;&lt;-")</span></span></span>
<span class="r-in"><span>  <span class="va">agents_history</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">agents_history</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="agents_smallworld.html">get_agents_states</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Derek Meyer, George Vega Yon, Centers for Disease Control and Prevention.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

